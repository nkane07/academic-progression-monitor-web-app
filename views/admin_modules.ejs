<!DOCTYPE html>
<html>
<head>
  <title>Manage Modules</title>
  
  <link rel="stylesheet" href="/styles.css">
 
</head>
<body>
  <%- include("partials/banner") %>


  <header>
    <h2>Manage Modules</h2>
    <nav>
      <a href="/admin/modules/new" class="button">Add Module</a>
     
    </nav>
  </header>

  <main class="container">
    <% if (req.query.added) { %>
        <div id="alertAdded" class="alert success">Module added successfully!</div>
      <% } %>
      <% if (req.query.updated) { %>
        <div id="alertUpdated" class="alert success">Module updated successfully!</div>
      <% } %>
      <% if (req.query.deleted) { %>
        <div id="alertDeleted" class="alert success">Module deleted successfully!</div>
      <% } %>
      
      <form method="get" action="/admin/modules" style="display: flex; justify-content: center; gap: 10px; margin-bottom: 1rem;">
        <div style="position: relative;">
          <input 
            type="text" 
            name="search" 
            value="<%= search %>" 
            placeholder="Search module code or name..." 
            style="padding-right: 30px;"
          />
          <% if (search) { %>
            <a href="/admin/modules" 
               style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); text-decoration: none; font-weight: bold; color: #888; font-size: 1rem;">
              ✕
            </a>
          <% } %>
        </div>
      
        <button type="submit" class="button">Search</button>
      </form>
      
      
      <p class="page-label"><%= totalModules %> module<%= totalModules !== 1 ? "s" : "" %> found</p>
      
      
    <table>
      <thead>
        <tr>
          <th>Code</th>
          <th>Name</th>
          <th>Credits</th>
          <th>Pathway</th>
          <th>Semester</th>
          <th>Manage</th>
        </tr>
      </thead>
      <tbody>
        <% modules.forEach(mod => { %>
          <tr>
            <td><%= mod.module_code %></td>
            <td><%= mod.module_name %></td>
            <td><%= mod.credit_value %></td>
            <td><%= mod.degree_programme_code %></td>
            <td>Semester <%= mod.semester %></td>
            
            <td>
              <a href="/admin/modules/<%= mod.module_id %>/edit" class="button">Edit</a>
              <form action="/admin/modules/<%= mod.module_id %>/delete" method="POST" style="display:inline;">
                <button type="submit" class="button outline" onclick="return confirm('Are you sure you want to delete this module?')">Delete</button>
              </form>
            </td>
          </tr>
        <% }) %>
      </tbody>
      
    </table>
    <% if (modules.length > 0) { %>
        <p class="page-label">Page <%= currentPage %> of <%= totalPages %></p>
      
        <div class="pagination">
          <% if (currentPage > 1) { %>
            <a href="/admin/modules?page=<%= currentPage - 1 %>" class="page-button">Previous</a>
          <% } %>
      
          <% 
            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
      
            if (endPage - startPage < maxVisible - 1) {
              startPage = Math.max(1, endPage - maxVisible + 1);
            }
          %>
      
          <% for (let i = startPage; i <= endPage; i++) { %>
            <a href="/admin/modules?page=<%= i %>" class="page-button <%= i === currentPage ? 'active' : '' %>">
              <%= i %>
            </a>
          <% } %>
      
          <% if (currentPage < totalPages) { %>
            <a href="/admin/modules?page=<%= currentPage + 1 %>" class="page-button">Next</a>
          <% } %>
        </div>
      <% } %>
      
  </main>

  <footer>
    <p>University Portal © <%= currentYear %></p>
  </footer>
  <script>
    ["alertAdded", "alertUpdated", "alertDeleted"].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        setTimeout(() => {
          el.style.transition = "opacity 0.5s ease";
          el.style.opacity = "0";
          setTimeout(() => el.remove(), 500);
        }, 4000);
      }
    });
  </script>
  
</body>
</html>
